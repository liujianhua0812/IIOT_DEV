# 数据库端口分析报告

## 检查结果总结：

1. **数据库实际部署位置**：
   - Docker容器：iiot_postgres
   - 容器内IP：172.21.0.2
   - 容器内端口：5432
   - Docker端口映射：5432:5432（容器5432 -> 宿主机5432）

2. **宿主机监听情况**：
   - 监听地址：0.0.0.0:5432（所有网络接口）
   - 内网IP：192.168.34.14
   - 公网IP：166.111.80.127

3. **端口映射关系**：
   - 数据库实际运行端口：5432（容器内和宿主机都是）
   - 外部访问端口：15432（NAT端口映射）
   - 映射规则：公网 166.111.80.127:15432 -> 内网 192.168.34.14:5432

4. **连接测试结果**：
   - 本地连接 127.0.0.1:5432：成功 ✓
   - 本地连接 192.168.34.14:5432：成功 ✓
   - 本地连接 166.111.80.127:15432：失败 ✗（原因：NAT映射仅对公网访问生效）
   - Windows远程连接 166.111.80.127:15432：成功 ✓（通过公网NAT映射）

## 结论：

数据库实际部署在5432端口，15432是网络层面的端口映射（NAT），用于外部访问。
本地服务器无法通过15432端口访问，是因为NAT映射是在网关/路由器/防火墙层面做的，
只对从公网访问的请求生效，本地访问不会经过这个映射。
